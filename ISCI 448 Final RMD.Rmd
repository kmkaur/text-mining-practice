---
title: "ISCI448"
author: "Olivia T. Li and Katrina M. Kaur"
date: "April 1, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## overview

Species interactions (for example, between plants and their pollinators or predators and their prey) play a major role in shaping both a species’ ecology (their abundance and distribution) and their evolutionary trajectories. In this project, we focus specifically on how these interactions drive evolution over very long time periods (e.g., millions of years). While there is
a great deal of theory and empirical evidence supporting the importance of competitive interactions between species on shaping large-scale patterns of evolution, there is relatively little known about how the consequences of engaging in mutualistic/cooperative interactions. Mathematical theory suggests that cooperating with another species should reduce the chance
that one of the partners ‘speciates’ (splits into two new species); as a result non-mutualistic species should become more common than the opposite. However, a number of recent empirical studies have found that groups that engage in cooperation are actually more diverse than groups that do not; this observation is at odds with the theory. In this project we have tried to reconcile these contradiction by investigating in finer detail the structure of the network of our study group (ants and plants). In order to do this, we have constructed a network showing which ant species interact with which plant species.

We have written computer code to “read” through thousands and thousands of scientific abstracts and pull out information on which ant species are involved in mutualistic interactions with plants (as well as which species of plants). We have then assembled this information into a database so that a network of plant-ant interactions can be built. This network will then be used in the future to address questions regarding whether mutualistic/cooperative interactions
generate diversity.

## pre_process data blurb


## packages used
```{r}
library(tidyr)
library(diplyr)
library(zoo)
library(taRifx)
```

## Setting working directory
```{r}
setwd("~/Desktop")
```

## Separating columns for abstract number and genus and species name
## Leaving NA on the left side if the abstract number is missing
```{r}
tidy_table <- 
  tab %>%
  separate(abs.name, into = c("abs", "genus", "species"), fill = "left")
```

## Creating new column with full binomial name
## Then removing the genus and species columns
```{r}
tidy_table$name <- paste(tidy_table$genus, tidy_table$species)
tidy_table$genus <- NULL
tidy_table$species <- NULL
```

## Filling in the NA with the abstracts above
```{r}
tidy_table2 <- tidy_table %>% 
  do(na.locf(.))
```

## Data is now prepared for process_data.R file to make 0 and 1 matrix

## Seed Dispersal 
```{r}
sd_raw <- read.csv(file = "sd_network_tm_raw_2.csv", header = TRUE)

sd_tidy_table <- 
      sd_raw %>%
        separate(abs.name, into = c("abs", "genus", "species"), fill = "left")

sd_tidy_table$name <- paste(sd_tidy_table$genus, sd_tidy_table$species)
sd_tidy_table$genus <- NULL
sd_tidy_table$species <- NULL

sd_tidy_table2 <- sd_tidy_table %>% 
                  do(na.locf(.))
write.csv(sd_tidy_table2, file = "sd_network_tm_processed_2.csv")
```

## Extrafloral Nectar 
```{r}
efn_raw <- read.csv(file = "efn_network_tm_raw_2.csv", header = TRUE)

efn_tidy_table <- 
  efn_raw %>%
  separate(abs.name, into = c("abs", "genus", "species"), fill = "left")

efn_tidy_table$name <- paste(efn_tidy_table$genus, efn_tidy_table$species)
efn_tidy_table$genus <- NULL
efn_tidy_table$species <- NULL

efn_tidy_table2 <- efn_tidy_table %>% 
  do(na.locf(.))
write.csv(efn_tidy_table2, file = "efn_network_tm_processed_2.csv")
```

#Domatia
```{r}
dom_raw <- read.csv(file = "dom_network_tm_raw_2.csv", header = TRUE)

dom_tidy_table <- 
  dom_raw %>%
  separate(abs.name, into = c("abs", "genus", "species"), fill = "left")

dom_tidy_table$name <- paste(dom_tidy_table$genus, dom_tidy_table$species)
dom_tidy_table$genus <- NULL
dom_tidy_table$species <- NULL

dom_tidy_table2 <- dom_tidy_table %>% 
  do(na.locf(.))
write.csv(dom_tidy_table2, file = "dom_network_tm_processed_2.csv")
```



## Process_data blurb

## Loading list of ants and plants to use in sorting the sd, efn, dom lists
## Ants
```{r}
ant_list <- read.csv("worldants_specieslist.csv", header=TRUE)
ant_list <- as.data.frame(ant_list$current.valid.name)
colnames(ant_list) <- "ants"
levels(ant_list$ants) <- tolower(levels(ant_list$ants))
```

## Plants
```{r}
angiosperms_list <- as.data.frame(read.csv("all_angiosperms.csv", header = TRUE, stringsAsFactors = FALSE))
colnames(angiosperms_list) <- "plants"
```

## Removing abstracts that had only one species appear 
```{r}
practice_species2 <- practice_species[practice_species$V1 %in% practice_species$V1[duplicated(practice_species$V1)],]
```

## Sorting into two lists, one with the ants that appeared and one with the plants
```{r}
ants_prac <- practice_species2 %>% filter(V2 %in% ant_list$ants)
ants_prac <- remove.factors(ants_prac)
plants_prac <- practice_species2 %>% filter(V2%in% angiosperms_list$plants)
plants_prac <- remove.factors(plants_prac)
```

## Merging into one table, with the columns abstracts, ants, plants 
```{r}
together_prac <- merge(ants_prac, plants_prac, by="V1")
colnames(together_prac) <- c("abs", "ants", "plants")
```

## Removing abstract IDs as they are no longer needed
```{r}
together_prac$abs <- NULL
```

## Turning table with two columns into a 0 and 1 matrix
```{r}
final_table_prac <- table(together_prac)
final_table_prac <- (final_table_prac > 0) + 0
```

## Seed Dispersal
```{r}
sd_network <- read.csv("sd_network_tm_processed_2.csv", header=TRUE)
sd_network2 <- sd_network[sd_network$abs %in% sd_network$abs[duplicated(sd_network$abs)],]
sd_network2$X <- NULL

ants_sd <- sd_network2 %>% filter(name %in% ant_list$ants)
ants_sd <- remove.factors(ants_sd)
plants_sd <- sd_network2 %>% filter(name %in% angiosperms_list$plants)
plants_sd <- remove.factors(plants_sd)

write.csv(ants_sd, file = "seed_dispersal_ants_2.csv")
write.csv(plants_sd, file = "seed_dispersal_plants_2.csv")

together_sd <- merge(ants_sd, plants_sd, by="abs")
colnames(together_sd) <- c("abs", "ants", "plants")

together_sd$abs <- NULL

final_table_sd <- table(together_sd)
final_table_sd <- (final_table_sd > 0) + 0
write.csv(final_table_sd, file = "sd_01_network.csv")
```

## Extrafloral Nectar
```{r}
efn_network <- read.csv("efn_network_tm_processed_2.csv", header=TRUE)
efn_network2 <- efn_network[efn_network$abs %in% efn_network$abs[duplicated(efn_network$abs)],]
efn_network2$X <- NULL

ants_efn <- efn_network2 %>% filter(name %in% ant_list$ants)
ants_efn <- remove.factors(ants_efn)
plants_efn <- efn_network2 %>% filter(name %in% angiosperms_list$plants)
plants_efn <- remove.factors(plants_efn)

together_efn <- merge(ants_efn, plants_efn, by="abs")
colnames(together_efn) <- c("abs", "ants", "plants")

write.csv(ants_efn, file = "efn_ants_2.csv")
write.csv(plants_efn, file = "efn_plants_2.csv")

together_efn$abs <- NULL

final_table_efn <- table(together_efn)
final_table_efn <- (final_table_efn > 0) + 0
write.csv(final_table_efn, file = "efn_01_network.csv")
```

## Domatia
```{r}
dom_network <- read.csv("dom_network_tm_processed_2.csv", header=TRUE)
dom_network2 <- dom_network[dom_network$abs %in% dom_network$abs[duplicated(dom_network$abs)],]
dom_network2$X <- NULL

ants_dom <- dom_network2 %>% filter(name %in% ant_list$ants)
ants_dom <- remove.factors(ants_dom)
plants_dom <- dom_network2 %>% filter(name %in% angiosperms_list$plants)
plants_dom <- remove.factors(plants_dom)

write.csv(ants_dom, file = "domatia_ants_2.csv")
write.csv(plants_dom, file = "domatia_plants_2.csv")

together_dom <- merge(ants_dom, plants_dom, by="abs")
colnames(together_dom) <- c("abs", "ants", "plants")

together_dom$abs <- NULL

final_table_dom <- table(together_dom)
final_table_dom <- (final_table_dom > 0) + 0
write.csv(final_table_dom, file = "dom_01_network.csv")
```

